% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cosimmr_ffvb.R
\name{cosimmr_ffvb}
\alias{cosimmr_ffvb}
\title{Run a \code{cosimmr_input} object through the Fixed Form Variational
Bayes(FFVB) function}
\usage{
cosimmr_ffvb(
  simmr_in,
  prior_control = list(mu_0 = rep(0, simmr_in$n_sources), sigma_0 = 1, tau_shape =
    rep(0.5, simmr_in$n_tracers), tau_rate = rep(0.5, simmr_in$n_tracers)),
  ffvb_control = list(n_output = 3600, S = 100, P = 10, beta_1 = 0.9, beta_2 = 0.9, tau =
    150, eps_0 = 0.1, t_W = 50)
)
}
\arguments{
\item{simmr_in}{An object created via the function \code{\link{cosimmr_load}}}

\item{prior_control}{A list of values including arguments named \code{mu_0}
(prior for mu), and \code{sigma_0} (prior for sigma).}

\item{ffvb_control}{A list of values including arguments named \code{n_output}
(number of rows in theta output), \code{S} (number of samples taken at each
iteration of the algorithm), \code{P} (patience parameter), \code{beta_1}
and \code{beta_2} (adaptive learning weights), \code{tau} (threshold for
exploring learning space), \code{eps_0} (fixed learning rate),
\code{t_W} (rolling window size)}
}
\value{
An object of class \code{cosimmr_output} with two named top-level
components: \item{input }{The \code{cosimmr_input} object given to the
\code{simmr_ffvb} function} \item{output }{A set of outputs produced by
the FFVB function. These can be analysed using the
\code{\link{summary.cosimmr_output}} and \code{\link{plot.cosimmr_output}}
functions.}
}
\description{
This is the main function of cosimmr. It takes a \code{cosimmr_input} object
created via \code{\link{cosimmr_load}}, runs it in fixed form
Variational Bayes to determine the dietary proportions, and then
outputs a \code{cosimmr_output} object for further analysis and plotting
via \code{\link{summary.cosimmr_output}} and \code{\link{plot.cosimmr_output}}.
}
\examples{
\dontrun{
## See the package vignette for a detailed run through of these 4 examples

# Data set 1: 10 obs on 2 isos, 4 sources, with tefs and concdep
data(geese_data_day1)
simmr_1 <- with(
  geese_data_day1,
  cosimmr_load(
    formula = mixtures ~ c(1,2,3,2,1,3,2,1,2),
    source_names = source_names,
    source_means = source_means,
    source_sds = source_sds,
    correction_means = correction_means,
    correction_sds = correction_sds,
    concentration_means = concentration_means
  )
)

# Plot
plot(simmr_1)

# Print
simmr_1

# FFVB run
simmr_1_out <- cosimmr_ffvb(simmr_1)

# Print it
print(simmr_1_out)

# Summary
summary(simmr_1_out, type = "correlations")
summary(simmr_1_out, type = "statistics")
ans <- summary(simmr_1_out, type = c("quantiles", "statistics"))

# Plot
plot(simmr_1_out, type = "boxplot")
plot(simmr_1_out, type = "histogram")
plot(simmr_1_out, type = "density")
plot(simmr_1_out, type = "matrix")

# Compare two sources
compare_sources(simmr_1_out, source_names = c("Zostera", "Enteromorpha"))

# Compare multiple sources
compare_sources(simmr_1_out)

#####################################################################################

# A version with just one observation
data(geese_data_day1)
simmr_2 <- with(
  geese_data_day1,
  simmr_loadcov(
    formula = mixtures[1, , drop = FALSE] ~ c(1),
    source_names = source_names,
    source_means = source_means,
    source_sds = source_sds,
    correction_means = correction_means,
    correction_sds = correction_sds,
    concentration_means = concentration_means
  )
)

# Plot
plot(simmr_2)

# FFVB run - automatically detects the single observation
simmr_2_out <- simmr_ffvb(simmr_2)

# Print it
print(simmr_2_out)

# Summary
summary(simmr_2_out)
ans <- summary(simmr_2_out, type = c("quantiles"))

# Plot
plot(simmr_2_out)
plot(simmr_2_out, type = "boxplot")
plot(simmr_2_out, type = "histogram")
plot(simmr_2_out, type = "density")
plot(simmr_2_out, type = "matrix")

#####################################################################################

# Data set 2: 3 isotopes (d13C, d15N and d34S), 30 observations, 4 sources
data(simmr_data_2)
simmr_3 <- with(
  simmr_data_2,
  cosimmr_load(
    formula = mixtures ~ c(rep(1, ncol(mixtures))),
    source_names = source_names,
    source_means = source_means,
    source_sds = source_sds,
    correction_means = correction_means,
    correction_sds = correction_sds,
    concentration_means = concentration_means
  )
)

# Get summary
print(simmr_3)

# Plot 3 times
plot(simmr_3)
plot(simmr_3, tracers = c(2, 3))
plot(simmr_3, tracers = c(1, 3))
# See vignette('simmr') for fancier axis labels

# FFVB run
simmr_3_out <- cosimmr_ffvb(simmr_3)

# Print it
print(simmr_3_out)

# Summary
summary(simmr_3_out)
summary(simmr_3_out, type = "quantiles")
summary(simmr_3_out, type = "correlations")

# Plot
plot(simmr_3_out)
plot(simmr_3_out, type = "boxplot")
plot(simmr_3_out, type = "histogram")
plot(simmr_3_out, type = "density")
plot(simmr_3_out, type = "matrix")

################################################################
}
}
\references{
Andrew C. Parnell, Donald L. Phillips, Stuart Bearhop, Brice X.
Semmens, Eric J. Ward, Jonathan W. Moore, Andrew L. Jackson, Jonathan Grey,
David J. Kelly, and Richard Inger. Bayesian stable isotope mixing models.
Environmetrics, 24(6):387â€“399, 2013.

Andrew C Parnell, Richard Inger, Stuart Bearhop, and Andrew L Jackson.
Source partitioning using stable isotopes: coping with too much variation.
PLoS ONE, 5(3):5, 2010.
}
\seealso{
\code{\link{cosimmr_load}} for creating objects suitable for this
function, \code{\link{plot.cosimmr_input}} for creating isospace plots,
\code{\link{summary.cosimmr_output}} for summarising output, and
\code{\link{plot.cosimmr_output}} for plotting output.
}
\author{
Emma Govan <emma.govan.2021@mumail.ie>
}
